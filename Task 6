{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "e680274b-22e2-4d52-8ca6-c4046d3851fe",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Visualization available only between 6 PM and 9 PM IST.\n"
     ]
    }
   ],
   "source": [
    "def task6_trend_chart():\n",
    "    import pandas as pd\n",
    "    import plotly.graph_objects as go\n",
    "    from datetime import datetime\n",
    "    import pytz\n",
    "\n",
    "    # ----------------------------\n",
    "    # Time Restriction\n",
    "    # ----------------------------\n",
    "    def is_dashboard_time():\n",
    "        india = pytz.timezone(\"Asia/Kolkata\")\n",
    "        now = datetime.now(india)\n",
    "        return 18 <= now.hour < 21\n",
    "\n",
    "    if not is_dashboard_time():\n",
    "        print(\"Visualization available only between 6 PM and 9 PM IST.\")\n",
    "        return\n",
    "\n",
    "    # ----------------------------\n",
    "    # Load Data\n",
    "    # ----------------------------\n",
    "    file_path = r\"C:\\Users\\user\\OneDrive\\Desktop\\Null Class\\Google Playstore Apps.csv\"\n",
    "    df = pd.read_csv(file_path)\n",
    "\n",
    "    # ----------------------------\n",
    "    # Preprocessing\n",
    "    # ----------------------------\n",
    "    df[\"Last Updated\"] = pd.to_datetime(df[\"Last Updated\"], errors=\"coerce\")\n",
    "    df = df.dropna(subset=[\"Last Updated\"])\n",
    "\n",
    "    df[\"Installs\"] = (\n",
    "        df[\"Installs\"].astype(str)\n",
    "        .str.replace(\",\", \"\", regex=False)\n",
    "        .str.replace(\"+\", \"\", regex=False)\n",
    "    )\n",
    "    df[\"Installs\"] = pd.to_numeric(df[\"Installs\"], errors=\"coerce\")\n",
    "    df[\"Reviews\"] = pd.to_numeric(df[\"Reviews\"], errors=\"coerce\")\n",
    "\n",
    "    # ----------------------------\n",
    "    # Filters\n",
    "    # ----------------------------\n",
    "    df = df[\n",
    "        (df[\"Reviews\"] > 500) &\n",
    "        (~df[\"App\"].str.lower().str.startswith((\"x\", \"y\", \"z\"), na=False)) &\n",
    "        (~df[\"App\"].str.contains(\"s\", case=False, na=False)) &\n",
    "        (df[\"Category\"].str.startswith((\"E\", \"C\", \"B\"), na=False))\n",
    "    ]\n",
    "\n",
    "    if df.empty:\n",
    "        print(\"No data available after applying filters.\")\n",
    "        return\n",
    "\n",
    "    # ----------------------------\n",
    "    # Monthly Aggregation\n",
    "    # ----------------------------\n",
    "    monthly = (\n",
    "        df.groupby([pd.Grouper(key=\"Last Updated\", freq=\"M\"), \"Category\"])\n",
    "          [\"Installs\"]\n",
    "          .sum()\n",
    "          .reset_index()\n",
    "          .rename(columns={\"Last Updated\": \"Month\",\n",
    "                           \"Installs\": \"Total_Installs\"})\n",
    "          .sort_values(\"Month\")\n",
    "    )\n",
    "\n",
    "    # ----------------------------\n",
    "    # Translate Categories\n",
    "    # ----------------------------\n",
    "    translation_map = {\n",
    "        \"BEAUTY\": \"सौंदर्य\",\n",
    "        \"BUSINESS\": \"வணிகம்\",\n",
    "        \"DATING\": \"Partnersuche\"\n",
    "    }\n",
    "    monthly[\"Category_Display\"] = monthly[\"Category\"].replace(translation_map)\n",
    "\n",
    "    # ----------------------------\n",
    "    # Month-over-Month Growth\n",
    "    # ----------------------------\n",
    "    monthly[\"MoM_Growth\"] = (\n",
    "        monthly.groupby(\"Category_Display\")[\"Total_Installs\"]\n",
    "               .pct_change()\n",
    "    )\n",
    "\n",
    "    # ----------------------------\n",
    "    # Plot\n",
    "    # ----------------------------\n",
    "    fig = go.Figure()\n",
    "    categories = monthly[\"Category_Display\"].unique()\n",
    "\n",
    "    for cat in categories:\n",
    "        cat_df = monthly[monthly[\"Category_Display\"] == cat]\n",
    "\n",
    "        # Line trend\n",
    "        fig.add_trace(\n",
    "            go.Scatter(\n",
    "                x=cat_df[\"Month\"],\n",
    "                y=cat_df[\"Total_Installs\"],\n",
    "                mode=\"lines\",\n",
    "                name=cat\n",
    "            )\n",
    "        )\n",
    "\n",
    "        # Highlight high growth points (>20% MoM)\n",
    "        high_growth = cat_df[cat_df[\"MoM_Growth\"] > 0.20]\n",
    "        fig.add_trace(\n",
    "            go.Scatter(\n",
    "                x=high_growth[\"Month\"],\n",
    "                y=high_growth[\"Total_Installs\"],\n",
    "                mode=\"markers\",\n",
    "                marker=dict(size=10, symbol=\"circle\"),\n",
    "                name=f\"{cat} (>20% growth)\",\n",
    "                showlegend=False\n",
    "            )\n",
    "        )\n",
    "\n",
    "    fig.update_layout(\n",
    "        title=\"Trend of Total Installs Over Time by Category\",\n",
    "        xaxis_title=\"Month\",\n",
    "        yaxis_title=\"Total Installs\",\n",
    "        hovermode=\"x unified\",\n",
    "        template=\"simple_white\",\n",
    "        legend_title=\"App Category\"\n",
    "    )\n",
    "\n",
    "    fig.show()\n",
    "\n",
    "task6_trend_chart()    "
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.14.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
fig6.write_html("dashboard_html/Updates_Graph_6.html")
