import os
import webbrowser
from datetime import datetime
import pytz

def open_dashboard():
    # ----------------- Time Setup -----------------
    tz = pytz.timezone("Asia/Kolkata")
    now = datetime.now(tz)
    current_hour = now.hour

    # ----------------- HTML Start -----------------
    dashboard_html = """
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Google Play Store Dashboard</title>
        <style>
            body{
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background: white;
            }
            .header{
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 15px;
                margin-bottom: 30px;
            }
            .header img{
                height: 40px;
            }
            h1{
                font-size: 24px;
                margin: 0;
            }
            .task{
                margin-bottom: 40px;
            }
            iframe{
                width: 100%;
                height: 450px;
                border: 1px solid #ccc;
            }
            .warning{
                color: red;
                font-weight: bold;
                margin-bottom: 20px;
            }
        </style>
    </head>
    <body>
    <div class="header">
        <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg">
        <h1>Google Play Store Analytics Dashboard</h1>
    </div>
    """

    # ----------------- Task 1 (No Time Restriction) -----------------
    dashboard_html += """
    <div class="task">
        <h2>Task 1 – Ratings vs Reviews</h2>
        <iframe src="task1.html"></iframe>
    </div>
    """

    # ----------------- Task 2 (1 PM – 2 PM IST) -----------------
    if 13 <= current_hour < 14:
        dashboard_html += """
        <div class="task">
            <h2>Task 2 – Free vs Paid Apps</h2>
            <iframe src="task2.html"></iframe>
        </div>
        """
    else:
        dashboard_html += """
        <div class="task">
            <h2>Task 2 – Free vs Paid Apps</h2>
            <div class="warning">Available only between 1 PM and 2 PM IST.</div>
        </div>
        """

    # ----------------- Task 3 (6 PM – 8 PM IST) -----------------
    if 18 <= current_hour < 20:
        dashboard_html += """
        <div class="task">
            <h2>Task 3 – Category Install Distribution</h2>
            <iframe src="task3.html"></iframe>
        </div>
        """
    else:
        dashboard_html += """
        <div class="task">
            <h2>Task 3 – Category Install Distribution</h2>
            <div class="warning">Available only between 6 PM and 8 PM IST.</div>
        </div>
        """

    # ----------------- Task 4 (4 PM – 6 PM IST) -----------------
    if 16 <= current_hour < 18:
        dashboard_html += """
        <div class="task">
            <h2>Task 4 – Cumulative Installs Over Time</h2>
            <iframe src="task4.html"></iframe>
        </div>
        """
    else:
        dashboard_html += """
        <div class="task">
            <h2>Task 4 – Cumulative Installs Over Time</h2>
            <div class="warning">Available only between 4 PM and 6 PM IST.</div>
        </div>
        """

    # ----------------- Task 5 (5 PM – 7 PM IST) -----------------
    if 17 <= current_hour < 19:
        dashboard_html += """
        <div class="task">
            <h2>Task 5 – App Size vs Rating Bubble Chart</h2>
            <iframe src="task5.html"></iframe>
        </div>
        """
    else:
        dashboard_html += """
        <div class="task">
            <h2>Task 5 – App Size vs Rating Bubble Chart</h2>
            <div class="warning">Available only between 5 PM and 7 PM IST.</div>
        </div>
        """

    # ----------------- Task 6 (6 PM – 9 PM IST) -----------------
    if 18 <= current_hour < 21:
        dashboard_html += """
        <div class="task">
            <h2>Task 6 – Total Installs Trend</h2>
            <iframe src="task6.html"></iframe>
        </div>
        """
    else:
        dashboard_html += """
        <div class="task">
            <h2>Task 6 – Total Installs Trend</h2>
            <div class="warning">Available only between 6 PM and 9 PM IST.</div>
        </div>
        """

    # ----------------- HTML End -----------------
    dashboard_html += """
    </body>
    </html>
    """

    # ----------------- Write and Open -----------------
    file_name = "dashboard.html"
    with open(file_name, "w", encoding="utf-8") as f:
        f.write(dashboard_html)

    webbrowser.open("file://" + os.path.abspath(file_name))

# ----------------- Run -----------------
open_dashboard()
